import requests
import json
 
api_key = "AIzaSyDtgCMpZdOCDWCUIkAzB41w-7MwA9iI3Vs"

def check_malware(url, api_key):
    """Check if a website is flagged for malware/phishing using Google Safe Browsing API."""
    api_url = "https://safebrowsing.googleapis.com/v4/threatMatches:find"
    
    payload = {
        "client": {"clientId": "CyberSentinel", "clientVersion": "0.2.0"},
        "threatInfo": {
            "threatTypes": ["MALWARE", "SOCIAL_ENGINEERING", "UNWANTED_SOFTWARE", "POTENTIALLY_HARMFUL_APPLICATION"],
            "platformTypes": ["ANY_PLATFORM"],
            "threatEntryTypes": ["URL"],
            "threatEntries": [{"url": url}]
        }
    }

    response = requests.post(api_url, json=payload, params={"key": api_key})
    
    # ‚úÖ Debugging: Print the API response
    print("üîç Google Safe Browsing API Response:")
    print(response.status_code, response.text)

    if response.status_code == 200:
        data = response.json()
        return data  # This should return the actual response, not an empty dict `{}`

    return {"error": "API request failed"}

